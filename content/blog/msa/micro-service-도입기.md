---
title: micro service 도입기
date: 2021-12-03 17:12:06
category: msa
thumbnail: { thumbnailSrc }
draft: false
---

팀내에서 새로 시작하는 프로젝트에 msa 를 도입하게 되면서 느꼈거나 생각했던 점들을 적어보려고 합니다.

## msa 를 왜 도입했나요?

새롭게 시작하는 프로젝트는 앞으로의 확장 가능성을 최대한 고려해서 틀을 짜놓고 시작하고 싶었습니다.  
사실 시작부터 msa 를 한다기보다는 앞으로 서비스를 쪼개기 용이하도록 미리 준비를 해놓는 것에 가까웠습니다.

## 도입하기전 마음속으로 정했던 조건들

1. 속도가 빨라야 한다 (low latency)
2. 서로 최소한의 의존성만 가져야 한다
3. 프로젝트가 최대한 복잡해지지 않아야 한다
4. 유지보수가 용이해야한다

## 프로젝트를 시작하며 고려했던것들

### 서비스를 나누는 기준

한번에 조회되지 않는 데이터를 기준삼아서 나누기로 했습니다  
예를들면 상품페이지에서는 결제관련 정보가 필요없기때문에 `상품서비스`, `결제서비스` 와 같은 방식으로 나누었습니다

### git repogitory

파이프라인에서 code test 할 때 통합테스트가 용이하도록 모든 서비스는 하나의 레파지토리에서 관리하기로 했습니다

### 데이터를 저장하는 방식

todo

### build pipeline

todo

### 배포

todo

### aws 서비스들

todo

### web framework (django vs fastapi)

우리는 메인 스택이 python이라서 `django + drf`와 `fastapi` 둘 중에서 고민하다 `fastapi` 를 선택했습니다.
그 이유는 다음과 같았습니다.

1. asgi 를 지원하기때문에 속도가 더 빠르다 (django도 3.x 버전으로 넘어오면서 asgi 를 지원하기 시작했지만 drf 는 아직 지원 안함)
2. `pydantic` 을 사용하면서 자연스럽게 만들어지는 swagger
3. 강제적인 typing
4. 구현할것이 상대적으로 많지만 가볍다
5. rdbms 에 의존하지 않는다

### test (unittest vs pytest)

지난 프로젝트에 unittest 를 사용하며 다음과 같은 아쉬운점이 있었기 때문에 pytest 를 사용하기로 결정했습니다.

1. 서드파티 라이브러리들의 지원부족 (pytest가 점점 표준으로 자리잡고 있는 것 같다)
2. 터미널 가독성 (`pytest`는 터미널 텍스트에 컬러링을 해준다)
3. 내장된 기능들
